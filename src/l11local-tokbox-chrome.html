<!-- Adapted from https://github.com/opentok/screensharing-extensions/blob/master/screensharing-test.html -->
<script src="//static.opentok.com/v2/js/opentok.js"></script>
<script type="text/javascript">
 // Go to https://dashboard.tokbox.com/ to get your OpenTok API Key and to generate
 // a test session ID and token:
 var apiKey = '45913722',
     sessionId = '2_MX40NTkxMzcyMn5-MTQ5OTkyMjQ4Mzg3MX5weEVreUEzcUl0R2FicTg0UHBBRkdXTEd-fg',
     token = 'T1==cGFydG5lcl9pZD00NTkxMzcyMiZzaWc9YjQ1NDhiYWVjMzY3MjJlMDkxOGExZDAyOTMwODUwZWQ1NjhlYTRiYTpzZXNzaW9uX2lkPTJfTVg0ME5Ua3hNemN5TW41LU1UUTVPVGt5TWpRNE16ZzNNWDV3ZUVWcmVVRXpjVWwwUjJGaWNUZzBVSEJCUmtkWFRFZC1mZyZjcmVhdGVfdGltZT0xNDk5OTIyNTEyJm5vbmNlPTAuNjAxODAzMzYyNjg3NTcxNCZyb2xlPXB1Ymxpc2hlciZleHBpcmVfdGltZT0xNTAyNTE0NTExJmluaXRpYWxfbGF5b3V0X2NsYXNzX2xpc3Q9';

 // Replace this with the ID for your Chrome screen-sharing extension, which you can
 // get at chrome://extensions/:

 var extensionId = 'kjfcooadbokjecaohkjjdbckjpaeaelc';

 // If you register your domain with the the Firefox screen-sharing whitelist, instead of using
 // a Firefox screen-sharing extension, set this to the Firefox version number, such as 36, in which
 // your domain was added to the whitelist:

 var ffWhitelistVersion; // = '36';

 var session = OT.initSession(apiKey, sessionId);

 /*session.connect(token, function(error) {
    if (error) {
    alert('Error connecting to session: ' + error.message);
    return;
    }*/
 // publish a stream using the camera and microphone:

 /*var audioContainerElement = document.createElement('div');
    var publisher = OT.initPublisher(
    audioContainerElement, {
    audioSource: 'default'
    },
    function(error) {
    if (error) {
    alert('Something went wrong: ' + error.message);
    } else {
    session.publish(
    publisher,
    function(error) {
    if (error) {
    alert('Something went wrong: ' + error.message);
    }
    });
    }
    });*/

 /*var publisher = OT.initPublisher('camera-publisher', {
    properties: {
    publishVideo: false,
    widthxheight: "1280x720"
    }
    });*/

 /* var publisher = OT.initPublisher('camera-publisher');*/
 /* session.publish(publisher);*/
 /* document.getElementById('shareBtn').disabled = false;*/
 /*});*/

 /*session.on('streamCreated', function(event) {
    console.log('streamCreated', event);
    if (event.stream.videoType === 'screen') {
    // This is a screen-sharing stream published by another client
    var subOptions = {
    width: event.stream.videoDimensions.width / 2,
    height: event.stream.videoDimensions.height / 2,
    subscribeToAudio: false,
    subscribeToVide: true
    };
    session.subscribe(event.stream, 'screen-subscriber', subOptions);
    } else {
    // This is a stream published by another client using the camera and microphone
    var subOptions = {
    subscribeToAudio: true,
    subscribeToVide: false
    };
    session.subscribe(event.stream, 'camera-subscriber', subOptions);
    }
    });*/

 // For Google Chrome only, register your extension by ID,
 // You can find it at chrome://extensions once the extension is installed
 OT.registerScreenSharingExtension('chrome', extensionId, 2);

 function screenshare() {
   OT.checkScreenSharingCapability(function(response) {
     console.info(response);
     if (!response.supported || response.extensionRegistered === false) {
       alert('This browser does not support screen sharing.');
     } else if (response.extensionInstalled === false &&
                (response.extensionRequired || !ffWhitelistVersion)) {
       alert('Please install the screen-sharing extension and load this page over HTTPS.');
     } else if (ffWhitelistVersion && navigator.userAgent.match(/Firefox/) &&
                navigator.userAgent.match(/Firefox\/(\d+)/)[1] < ffWhitelistVersion) {
       alert('For screen sharing, please update your version of Firefox to ' +
             ffWhitelistVersion + '.');
     } else {
       // Screen sharing is available. Publish the screen.
       // Create an element, but do not display it in the HTML DOM:
       var screenContainerElement = document.createElement('div');
       var screenSharingPublisher = OT.initPublisher(
         screenContainerElement, {
           videoSource: 'screen',
           publishVideo: true,
           /* resolution: '1280x720', not applicable for screen-sharing https://tokbox.com/developer/guides/screen-sharing/js/#maximum-resolution */
           frameRate: 15,
           audioSource: false,
           publishAudio: false
         },
         function(error) {
           if (error) {
             alert('Something went wrong: ' + error.message);
           } else {
             console.log('screenSharingPublisher', screenSharingPublisher);
             session.publish(
               screenSharingPublisher,
               function(error) {
                 if (error) {
                   alert('Something went wrong: ' + error.message);
                 }
               });
           }
         });

       session.connect(token, function(error) {
         if (error) {
           alert('Error connecting to session: ' + error.message);
           return;
         }
         var audioContainerElement = document.createElement('div');
         var audioPublisher = OT.initPublisher(
           audioContainerElement, {
             videoSource: false
             /* publishVideo: false,*/
             /* audioSource: 'audio',*/
             /* publishAudio: true*/
           },
           function(error) {
             if (error) {
               alert('Something went wrong: ' + error.message);
             } else {
               console.log('audioPublisher', audioPublisher);
               session.publish(
                 audioPublisher,
                 function(error) {
                   if (error) {
                     alert('Something went wrong: ' + error.message);
                   }
                 });
             }
           });
       });
     }
   });
 }

 screenshare();
</script>
